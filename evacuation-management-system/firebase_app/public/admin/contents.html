<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Contents</title>

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/7.19.1/firebase-app.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/7.19.1/firebase-auth.js"></script>
    <script defer src="/__/firebase/7.19.1/firebase-database.js"></script>
    <script defer src="/__/firebase/7.19.1/firebase-messaging.js"></script>
    <script defer src="/__/firebase/7.19.1/firebase-storage.js"></script>
    <script defer src="/__/firebase/7.19.1/firebase-firestore.js"></script>
    <script defer src="/__/firebase/7.19.1/firebase-functions.js"></script>
    <!-- initialize the SDK after all desired features are loaded -->
    <script defer src="/__/firebase/init.js"></script>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="js/jquery-3.0.0.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <link href="css/main-style.css" rel="stylesheet">
    <script src="js/vue.js"></script>
    <script src="../_global/js/objects.js"></script>
    <script src="../_global/js/utilities.js"></script>
    <script src="../_global/js/datahandler.js"></script>

</head>

<body>

    <div class="sidenav" id="header" attr="content">
        <div class="sidenav-item">
            <img class="nav-image" src="resources/images/logo.png" />
        </div>

        <div v-for="item in header_items" v-bind:class="'sidenav-item ' + (active == item.id ? 'active' : '') ">
            <a v-bind:href="item.href">
                <div class="icon-block">
                    <i class="material-icons">{{item.icon}}</i>
                    <h5 class="center">{{item.title}}</h5>
                </div>
            </a>
        </div>

        <div class="sidenav-item">
            <a v-on:click="onLogout()">
                <div class="icon-block">
                    <i class="material-icons">close</i>
                    <h5 class="center">Log Out</h5>
                </div>
            </a>
        </div>
    </div>
    <div class="container" id="content">

        <!-- CONTENT -->
        <div class="section">
            <h1>Home</h1>
            <h3>Contents</h3>
            <div class="row selection-grid">
                <div class="col col-md-4 selection-grid-item" v-for="item in selections">
                    <div class="selection-grid-item-content" :style="'background:'+item.color">
                        <a class="selection-grid-item-content-link" :href="item.href">
                            <div class="selection-block">
                                <i class="material-icons selection-icon">{{item.icon}}</i>
                                <h5 class="center">{{item.title}}</h5>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="section">

            <h3>Evacuations</h3>

            <div class="loader-container" v-if="isLoading">
                <div class="loader"></div>
            </div>

            <div class="section" v-if="evac_list.length > 0">
                <div class="table-container" id="tableData">
                    <div class="well" v-for="item,index in view_list">
                        <div class="row">
                            <div class="col col-md-12 item-info">
                                <p class="item-label">
                                    {{header_labels['id']}}:
                                </p>
                                <p class="item-value">
                                    {{item.id}}
                                </p>
                            </div>

                            <div class="col col-md-12 item-info">
                                <p class="item-label">
                                    {{header_labels['name']}}:
                                </p>
                                <p class="item-value">
                                    {{item.name}}
                                </p>
                            </div>
                            <div class="col col-md-12 item-info">
                                <p class="item-label">
                                    {{header_labels['admin_id']}}:
                                </p>
                                <p class="item-value">
                                    {{admins_selection[item.admin_id]}}
                                </p>
                            </div>
                            <div class="col col-md-3 item-info">
                                <p class="item-label">
                                    {{header_labels['population_capacity']}}:
                                </p>
                                <p class="item-value">
                                    {{item.population_capacity}}
                                </p>
                            </div>
                            <div class="col col-md-3 item-info">
                                <p class="item-label">
                                    {{header_labels['floor_space']}}:
                                </p>
                                <p class="item-value">
                                    {{item.floor_space}}
                                </p>
                            </div>
                            <div class="col col-md-3 item-info">
                                <p class="item-label">
                                    {{header_labels['contact_numbers']}}:
                                </p>
                                <p class="item-value">
                                    {{item.contact_numbers}}
                                </p>
                            </div>
                            <div class="col col-md-4 item-info">
                                <p class="item-label">
                                    {{header_labels['category']}}:
                                </p>
                                <p class="item-value">
                                    {{item.category}}
                                </p>
                            </div>
                            <div class="col col-md-12 item-info">
                                <p class="item-label">
                                    {{header_labels['facilities']}}:
                                </p>
                                <p class="item-value">
                                    {{item.facilities}}
                                </p>
                            </div>
                            <div class="col col-md-12 item-info">
                                <p class="item-label">
                                    {{header_labels['exact_address']}}:
                                </p>
                                <p class="item-value">
                                    {{item.exact_address}}
                                </p>
                            </div>
                            <div class="col col-md-12 item-info">
                                <p class="item-label">
                                    {{header_labels['location']}}:
                                </p>
                                <p class="item-value" style="margin-right: 10px;">
                                    lat: {{item.location.lat}}
                                </p>
                                <p class="item-value">
                                    lng: {{item.location.lng}}
                                </p>
                            </div>
                            <div class="col col-md-12 item-info">
                                <p class="item-label">
                                    Date:
                                </p>
                                <p class="item-value" style="margin-right: 10px;">
                                    Created: {{ formatDate(item.date_created)}}
                                </p>
                                <p class="item-value">
                                    Updated: {{ formatDate(item.date_updated)}}
                                </p>
                            </div>
                            <div class="col col-md-12">
                                <button class="btn btn-default btn-info" :href="'#imagerow'+index"
                                    data-toggle="collapse">view pictures</button>
                            </div>
                        </div>
                        <div :id="'imagerow'+index" class="panel-collapse collapse">
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col col-md-12" v-if="!item.images || item.images.length <= 0">
                                        <p>Images are empty</p>
                                    </div>
                                    <div class="col col-md-2 item-info" v-for="image,index in item.images">
                                        <!-- <img :src="cdn+image" class="img-thumbnail img-grid"/> -->
                                        <div class="image-area">
                                            <img :src="cdn+image" alt="Preview">
                                            <a class="remove-image" v-on:click="onDeleteImage(item.id, index)"
                                                style="display: inline;">&#215;</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-footer">
                                <div class="row">
                                    <p>Upload Images</p>
                                    <input :id="'input_images'+index" type="file" name="files[]" multiple
                                        style="margin-bottom: 12px;" />
                                    <button class="btn btn-default btn-info" v-on:click="onAddImages(index)">upload
                                        pictures</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="js/app/app.js"></script>

    <script>
        app = new Vue({
            el: '#content',
            data: {
                user: new AdminUser(),
                admins: [],
                admins_selection: {},

                selections: [{
                        id: 'homepage',
                        href: "content_homepage.html",
                        icon: 'web',
                        title: 'Content',
                        color: '#32a852'
                    },
                    {
                        id: 'gallery',
                        href: "content_gallery.html",
                        icon: 'perm_media',
                        title: 'Gallery',
                        color: '#60A244'
                    },
                    {
                        id: 'events',
                        href: "content_events.html",
                        icon: 'today',
                        title: 'Events',
                        color: '#fcba03'
                    },
                    {
                        id: 'documents',
                        href: "content_documents.html",
                        icon: 'article',
                        title: 'Documents',
                        color: '#4287f5'
                    },
                    {
                        id: 'information',
                        href: "content_information.html",
                        icon: 'live_help',
                        title: 'Other Informations',
                        color: '#eb4034'
                    },
                ],

                /* EVACUATIONS */
                evac_list: [],
                view_list: [],
                headers: Object.keys(EvacuationCenter.headers),
                header_labels: EvacuationCenter.headers,
                evac_data_input: new EvacuationCenter(), //new EvacuationCenter(), 
                evacFormModel: EvacuationCenter.formModel,
                cdn: DataHandlerType.api_host,
                isLoading: false
            },
            methods: {
                onStart() {
                    this.user = header.user
                    this.fetchAllAdmins()
                    this.fetchEvacationCenter()
                },

                fetchAllAdmins() {
                    /* let evacs = this.evac_list
                    this.evac_list = [] */
                    DataHandler.getAdminUsers(this.user.id).then((message) => {
                        this.admins = message.data

                        this.admins.map(admin => {
                            this.admins_selection[admin.id] =
                                `${admin.lastname}, ${admin.firstname}`
                        });

                        //this.evac_list = evacs
                    }).catch((error) => {
                        console.log(error)
                    })
                }, //fetchAllAdmins

                fetchEvacationCenter() {
                    this.isLoading = true

                    DataHandler.getEvacuationCenters(this.user.municipality).then((data) => {
                        this.evac_list = data.data
                        this.view_list = data.data
                        console.log("evac_list %o", this.evac_list)
                    }).catch(err => {
                        console.log(err)
                    }).finally(() => {
                        this.isLoading = false
                    })

                }, //fetchEvacationCenter

            }
        })
    </script>

</body>

</html>